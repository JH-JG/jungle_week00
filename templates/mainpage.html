<!-- 

main page

-->

<!Doctype html>
<html lang="ko">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>

    <!-- 구글폰트 -->
    <link href="https://fonts.googleapis.com/css?family=Stylish&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

</head>

<body>
    <div class="container">
        <div class="header">
            <span class="title">괴식쟁이들</span>
            {% if session.get('user_id') %} <!-- 세션에 user_id가 있으면 로그인 상태 -->
                <button class="bookmark-btn" onclick="location.href = '{{url_for('bookmark')}}'"> 즐겨찾기 </button>
                
                <!--add_post로 이동-->
                <button class="post-btn" onclick="location.href = '{{url_for('restaurant_page')}}'"> 글작성 </button>

                <!--로그아웃-->
                <button class="logout-btn" onclick="location.href = '{{url_for('logout')}}'"> 로그아웃 </button>

            {% else %}
                <!--vs code에서 js로 인식해서 나는 오류 실행할 때 문제 없음-->
            <button class="login-btn" onclick="location.href='{{ url_for('login') }}'">로그인</button>
            
            <!--비회원일 땐 즐겨찾기 버튼 숨기기-->
            <style> .corner-icon {display: none; }</style>
            {% endif %}
            
        </div>
        <!-- DB에 등록된 post 데이터 전체에 제목 가지고 오기-->
        <!--card grid로 post 데이터 표현 / card 클릭 시 상세 페이지로 이동-->
        <!--즐겨찾기 버튼 클릭시 해당 게시물을 회원 bookmark에 추가
        post_id를 해당 user에 저장
        1. title로 post_id 찾기 -> title은 중복될 수 있음 처음부터 post_id와 title 정보를 가져올 것
        2. poset_id는 클라이언트에게 보이지 않음
        3. 회원이 bookmark-btn 클릭 시 해당 post_id를 해당 user 컬렉션에(?) 추가 / 중첩? mongoDB 특성을 생각할 것
        -->

        <div class="search-box">
            <input type="text" placeholder="검색어를 입력하세요">
        </div>
    
        <div class="card-grid">
            {% for post in posts %}
            <div class="card" data-post-id="{{ post._id }}">
                <div class="card-image"></div>
                <button class="bookmark-btn">☆</button>
                <div class="card-title">{{ post.title }}</div>
            </div>
            {% endfor %}
        </div>
    </div>

    </div>



    <script>
        $(document).ready(function() {
            $('.bookmark-btn').click(function(e) {
                e.preventDefault();
                const card = $(this).closest('.card');
                const postId = card.data('post-id');
        
                if (!postId) {
                    alert('post ID가 없습니다.');
                    return;
                }
        
                $.ajax({
                    url: '/add_bookmark',
                    method: 'POST',
                    data: { post_id: postId },
                    success: function(res) {
                        alert(res.message || '북마크 성공');
                    },
                    error: function(xhr) {
                        if (xhr.status === 401 && xhr.responseJSON?.redirect) {
                            window.location.href = xhr.responseJSON.redirect;
                        } else if (xhr.responseJSON?.error) {
                            alert(xhr.responseJSON.error);
                        } else {
                            alert('알 수 없는 오류');
                        }
                    }
                });
            });
        });
        </script>

        
</body>



</html>